<p>In questi giorni clamav dava degli errori, così le email si fermavano in /var/lib/amavis senza essere consegnate (non comparivano comunque nella coda che si visualizza col comando mailq).</p>
<p>Le email sono nel formato rfc 822, ognuna con nome email.txt contenuta in una cartella con nome amavis-&lt;timestamp&gt;. Oltre al file dell&#39;email è presente una cartella parts con gli allegati (probabilmente amavis li estrae dall&#39;email per passarli con l&#39;antivirus). Comunque a noi tale cartella non interessa perché gli allegati compaiono anche nel file email.txt</p>
<p>Abbiamo quindi provato a disabilitare clamav, che continuava a dare errore, agendo sul file /etc/amavis/amavisd.conf, ma ciò non è bastato perché a questo punto era amavis adare errore. Abbiamo allora disabilitato amavis da /etc/postfix/main.cf (fonte: <a href="http://www.faqforge.com/linux/controlpanels/ispconfig3/how-to-disable-spamfilter-and-antivirus-functions-in-ispconfig-3/">http://www.faqforge.com/linux/controlpanels/ispconfig3/how-to-disable-spamfilter-and-antivirus-functions-in-ispconfig-3/</a> ) per fare in modo che il server di posta continuasse a funzionare. </p>
<p> </p>
<p>Abbiamo inoltre rispedito le email ferme in /var/lib/amavis con il comando</p>
<pre class="brush: bash;fontsize: 100; first-line: 1; "># for i in `ls amavis-*/email.txt`; do dest=`grep "^To:" $i | gawk -F ":" &#39;{print $2}&#39;`; dest2=`echo $dest | sed s/\&#39;//g`; cat $i | sendmail -v \&#39;$dest2\&#39;; done;</pre>