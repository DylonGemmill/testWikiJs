<p>Collegarsi in ssh al server ed eseguire questi comandi:</p>
<p> </p>
<pre class="brush: bash;fontsize: 100; first-line: 1; ">mkdir maldetect ; cd maldetect
wget http://www.rfxn.com/downloads/maldetect-current.tar.gz
tar xf maldetect-current.tar.gz
cd maldetect-*
./install.sh</pre>
<p> </p>
<p>Modificare in /usr/local/maldetect/conf.maldet i parametri:</p>
<ul>
<li>email_alert: 1</li>
<li>email_addr: lista di indirizzi email da notificare separata da virgola</li>
<li>quarantine_hits: 1</li>
<li>quarantine_clean: 1</li>
</ul>
<p> </p>
<p>Modificare il file /etc/cron.daily/maldet ed aggiungere nelle directory di scansione </p>
<pre class="brush: bash;fontsize: 100; first-line: 1; ">    elif [ -d "/var/www/clients" ] ; then
            # ISPConfig
            /usr/local/maldetect/maldet -b -r /var/www/clients/?/web?/web 2 &gt;&gt; /dev/null 
            /usr/local/maldetect/maldet -b -r /var/www/clients/?/web?/public 2 &gt;&gt; /dev/null 2&gt;&amp;1
            /usr/local/maldetect/maldet -b -r /var/www/clients/?/web?/ssl 2 &gt;&gt; /dev/null 2&gt;&amp;1
</pre>
<p> </p>
<p>Per eseguire una scansione una-tantum di un percorso:</p>
<pre class="brush: bash;fontsize: 100; first-line: 1; ">maldet -a /path/</pre>
<h2>Rotazione dei log</h2>
<p>Creare il file /etc/logrotate.d/maldet con questo contenuto (<a href="https://github.com/rfxn/linux-malware-detect/issues/28#issuecomment-69052186">vedi qui</a>):</p>
<pre class="brush: bash;fontsize: 100; first-line: 1; ">/usr/local/maldetect/logs/event_log
/usr/local/maldetect/logs/clamscan_log {
    missingok
    weekly
    compress
    notifempty
    size 1M
    rotate 4
    create 0644 root root
}
/usr/local/maldetect/logs/inotify_log {
    missingok
    weekly
    compress
    create 0644 root root
    notifempty
    size 1M
    rotate 4
    postrotate
        /etc/init.d/maldet condrestart &gt; /dev/null 2&gt;/dev/null || true
    endscript
}</pre>
<h2>Monitoraggio in tempo reale</h2>
<p>Prima occorre installare <em>inotifywait</em>:</p>
<pre class="brush: bash;fontsize: 100; first-line: 1; ">apt-get -y install inotify-tools</pre>
<p>Ci sono alcune modifiche da fare (dipende dalle versioni):</p>
<ol>
<li>in <em>conf.maldet</em> modificare <br /><span style="font-family: &#39;courier new&#39;, courier;">default_monitor_mode="users"<br />inotify_minuid="5000"<br />inotify_docroot="web"<br /><br /></span></li>
<li>creare il file /etc/sysctl.d/yetopen.conf con questo contenuto:<br />
<pre class="brush: bash;fontsize: 100; first-line: 1; "># Per maldet in modalita&#39; inotify
fs.inotify.max_user_watches=200000
</pre>
e ricaricare sysctl con <em>sysctl -p</em>.</li>
<li>avviare maldet con 
<pre>/etc/init.d/maldet start</pre>
</li>
</ol>
<p>Per monitorare l&#39;andamento della scansione vedere il file /usr/local/maldetect/logs/inotify_log.</p>
<p>La scansione viene effettuata ogni 30s circa. Le notifiche dei file rimossi o modificati viene inviata giornalmente all&#39;indirizzo email configurato.</p>
<p> </p>
<p><a href="http://www.howtoforge.com/forums/showthread.php?t=58440">http://www.howtoforge.com/forums/showthread.php?t=58440</a></p>
<p><a href="http://www.howtoforge.com/install-linux-malware-detect-lmd-on-centos?utm_source=feedly">http://www.howtoforge.com/install-linux-malware-detect-lmd-on-centos?utm_source=feedly</a></p>
<p> </p>
<p> </p>