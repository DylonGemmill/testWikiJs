<p><span>Fix the problem on the right way, use traffic control. Example to </span><br /><span>outgoing email 1Mbit limit. </span><br /><br /><br /><span># Clean all rules and set default pfifo_fast classless qdisc for each interface. </span><br /><span>tc qdisc show dev eth0 | grep -q pfifo_fast || tc qdisc  del dev eth0 root </span><br /><br /><span># Set Classfull Qdisc with Hierarchical Token Bucket Algoritm </span><br /><span># and setting class id 1001 as default to non-matched traffic by a filter. </span><br /><span>tc qdisc  add dev eth0 handle  1:     root  htb default 1001 </span><br /><br /><span># Class root (Available link) </span><br /><span>tc class  add dev eth0 classid 1:1000 root  htb rate 100Mbit ceil 100Mbit </span><br /><br /><span># Two childs (email/1002 and the others/1001) </span><br /><span>tc class  add dev eth0 classid 1:1001 parent 1:1000 htb rate 99Mbit ceil 99Mbit </span><br /><span>tc class  add dev eth0 classid 1:1002 parent 1:1000 htb rate 1Mbit ceil 1Mbit </span><br /><br /><span># Classifier outgoing emails (non-emails will be sent to class 1001) </span><br /><span>tc filter add dev eth0 protocol ip    parent 1: u32 flowid 1:1002 </span><br /><span>match ip dport 25 0xffff </span><br /><br /><span># attach Classless qdisc Stochastic Fairness Algoritm </span><br /><span># to improve (fairness) of concurrent connections. </span><br /><span>tc qdisc  add dev eth0 parent  1:1001 handle 1001:  sfq perturb 10 </span><br /><span>tc qdisc  add dev eth0 parent  1:1002 handle 1002:  sfq perturb 10 </span></p>
<p> </p>
<p> </p>
<p>http://postfix.1071664.n5.nabble.com/Limiting-outgoing-SMTP-connections-when-relaying-message-tp20029p20030.html</p>